{
  "type": "object",
  "title": "Notification Configuration",
  "definitions": {
    "ctx": {
      "type": "array",
      "title": "Context (ctx) Options",
      "uniqueItems": true,
      "items": {
        "anyOf": [
          {
            "properties": {
              "name": {
                "type": "string",
                "title": "Variable name"
              },
              "path": {
                "type": "string",
                "title": "Variable Path"
              }
            },
            "required": [
              "name",
              "path"
            ]
          },
          {
            "properties": {
              "method": {
                "type": "string",
                "title": "Variable Method"
              }
            },
            "required": [
              "method"
            ]
          }
        ]
      }
    },
    "mails": {
      "type": "object",
      "title": "Mails",
      "properties": {
        "default": {
          "type": "array",
          "title": "Default",
          "uniqueItems": true,
          "items": {
            "type": "string",
            "title": "Mail"
          }
        },
        "formatted": {
          "type": "array",
          "title": "Formatted",
          "uniqueItems": true,
          "items": {
            "type": "object",
            "title": "Mail",
            "properties": {
              "template": {
                "type": "string",
                "title": "Template"
              },
              "ctx": {
                "$ref": "#/definitions/ctx"
              }
            }
          }
        }
      }
    },
    "checks": {
      "title": "Checks",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "op": {
          "type": "string",
          "title": "AND/OR"
        },
        "checks": {
          "type": "array",
          "items": {
            "oneOf": [
              { "$ref": "#/definitions/checks" },
              { "$ref": "#/definitions/condition" }
            ]
          }
        }
      }
    },
    "condition": {
        "type": "object",
        "title": "Add Check",
        "additionalProperties": false,
        "properties": {
          "path": {
            "type": "string",
            "title": "Path"
          },
          "condition": {
            "type": "string",
            "title": "Condition"
          },
          "value": {
            "type": "string",
            "title": "Value"
          },
          "params": {
            "type": "object"
          }

        
    }}
  },
  "additionalProperties": false,
  "properties": {
    "actions": {
      "type": "object",
      "title": "Notification Actions",
      "additionalProperties": false,
      "patternProperties": {
        "^(publish|review)$": {
          "type": "array",
          "title": "Publish Options",
          "items": {
            "type": "object",
            "title": "Mail Config/Options",
            "required": ["recipients"],
            "properties": {
              "ctx": { "$ref": "#/definitions/ctx" },
              "subject": {
                "anyOf": [
                  {
                    "type": "object",
                    "title": "Mail Subject",
                    "additionalProperties": false,
                    "properties": {
                      "template": {
                        "type": "string",
                        "title": "Template string (Jinja format)"
                      },
                      "ctx": {
                        "$ref": "#/definitions/ctx"
                      },
                      "method": {
                        "type": "string",
                        "title": "Method name"
                      }
                    }
                  },
                  {
                    "type": "object",
                    "title": "Mail Subject",
                    "additionalProperties": false,
                    "properties": {
                      "template_file": {
                        "type": "string",
                        "title": "Template file (path)"
                      },
                      "ctx": {
                        "$ref": "#/definitions/ctx"
                      },
                      "method": {
                        "type": "string",
                        "title": "Method name"
                      }
                    }
                  }
                ]
              },
              "body": {
                "anyOf": [
                  {
                    "type": "object",
                    "title": "Mail Message",
                    "additionalProperties": false,
                    "properties": {
                      "template_file": {
                        "type": "string",
                        "title": "Template file (path)"
                      },
                      "ctx": {
                        "$ref": "#/definitions/ctx"
                      },
                      "base_template": {
                        "type": "string",
                        "title": "Base Template"
                      },
                      "plain": {
                        "type": "boolean",
                        "title": "Plain text or HTML"
                      }
                    }
                  },
                  {
                    "type": "object",
                    "title": "Mail Message",
                    "additionalProperties": false,
                    "properties": {
                      "template": {
                        "type": "string",
                        "title": "Template type (string/path)"
                      },
                      "ctx": {
                        "$ref": "#/definitions/ctx"
                      },
                      "base_template": {
                        "type": "string",
                        "title": "Base Template"
                      },
                      "plain": {
                        "type": "boolean",
                        "title": "Plain text or HTML"
                      }
                    }
                  }
                ]
              },
              "recipients": {
                "type": "object",
                "title": "Mail Recipients",
                "minProperties": 1,
                "patternProperties": {
                  "^(bcc|cc|recipients)$": {
                    "type": "array",
                    "title": "List of BCC recipients",
                    "uniqueItems": true,
                    "minItems": 1,
                    "items": {
                      "oneOf": [
                        {
                          "type": "string"
                        },
                        {
                          "additionalProperties": false,
                          "type": "object",
                          "properties": {
                            "op": {
                              "type": "string",
                              "title": "AND/OR"
                            },
                            "checks": {
                              "type": "array",
                              "items": {
                                "oneOf": [
                                  { "$ref": "#/definitions/checks" },
                                  { "$ref": "#/definitions/condition" }
                                ]
                              }
                            },
                            "mails": {
                              "$ref": "#/definitions/mails"
                            },
                            "method": {
                              "oneOf": [
                                {
                                  "title": "Method",
                                  "type": "string"
                                },
                                {
                                  "type": "array",
                                  "items": {
                                    "title": "Method",
                                    "type": "string"
                                  }
                                }
                              ]
                            }
                          }
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}